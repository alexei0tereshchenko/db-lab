# RabbitMQ

## Теоретический материал

На самостоятельное изучение.

 - https://www.rabbitmq.com/getstarted.html
 - https://habr.com/ru/post/149694/
 - https://habr.com/ru/post/150134/


## Локальная установка

Для локального запуска RabbitMQ в docker-контейнере используется команда:

```bash
> docker run -p 5672:5672 -p 8080:15672 rabbitmq:3-management
```

Порт 5672 используется для клиентских подключений, а порт 15672, переброшенный на 8080, для подключения к веб-интерфейсу администрирования сервера очередей.

Чтобы убедиться, что сервер и служба веб-администрирования работают корректно, пройдите по адресу http://localhost:8080. В качестве логина и пароля по умолчанию используются значения `guest` / `guest`. 

Веб-интерфейс позволяет просмотреть состояние очередей, а также количество сообщений в единицу времени, которое генерируется и считывается с сервера.

## Задание на лабораотрную работу

Для работы с серверами очередей используется библиотека `amqp-ts`, которая представляет собой строго типизированную обёртку над библиотекой протокола AMQP, который использутеся в RabbitMQ.

1. Изучить исходный код файлов `producer.ts` и `consumer.ts`.
2. Запустить `producer.ts`. При помощи веб-интерфейса убедиться, что сообщения попадают в очередь. Прервать выполнение `producer.ts`.
3. Запустить `consumer.ts`. Убедиться, что сообщения были изъяты из очереди. Когда все сообщения обработаны, прервать выполнение `conumer.ts`.
4. Изменить значение в `queue.prefetch` в `consumer.ts`. Объяснить полученный результат.
5. Реализовать в файле `faultyConsumer.ts` клиента по аналогии с `conumser.ts`, в котором сообщения захватываются на обработку, но генерируют ошибку и не подтверждает обработку сообщения (`message.nack()`) при появлении в сообщении в свойстве `number` любого числа, большего 10. Запустить параллельно `producer.ts` и `faultyConsumer.ts` и убедиться, что необработанные сообщения остаются в очреди. Затем запустить параллельно `consumer.ts` и убедиться, что все сообщения из очереди корректно обработались.
